<%- include("navbar.ejs") %>

    <!-- Breadcrumbs -->
    <section class="breadcrumb-section py-3 bg-light">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item"><a href="profile">My Profile</a></li>
                    <li class="breadcrumb-item active">Change Password</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Change Password Section -->
    <section class="change-password-section py-5">
        <div class="container">
            <div class="row">
                <!-- Profile Sidebar -->
                <div class="col-lg-3">
                    <div class="profile-card mb-4">
                        <img src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=200&q=80" 
                             class="profile-avatar" alt="Profile Picture">
                        <h4 class="mb-1"><%= user[0].first_name %> <%= user[0].last_name %></h4>
                        <p class="text-muted mb-3"><%= user[0].email %></p>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary btn-sm">
                                <i class="bi bi-camera me-2"></i>Change Photo
                            </button>
                        </div>
                    </div>
                    
                    <div class="profile-menu">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="/profile">
                                    <i class="bi bi-person me-2"></i>Profile Overview
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/profile-edit">
                                    <i class="bi bi-pencil me-2"></i>Edit Profile
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link active" href="/profile-password">
                                    <i class="bi bi-lock me-2"></i>Change Password
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/profile-orders">
                                    <i class="bi bi-box-seam me-2"></i>My Orders
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/profile-invoice">
                                    <i class="bi bi-receipt me-2"></i>Invoices
                                </a>
                            </li>
                           
                            <li class="nav-item">
                                <a class="nav-link" href="/wishlist">
                                    <i class="bi bi-heart me-2"></i>Wishlist
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/terms">
                                    <i class="bi bi-file-text me-2"></i>Terms & Conditions
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Change Password Content -->
                <div class="col-lg-9">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                <i class="bi bi-lock me-2"></i>Change Password
                            </h5>
                        </div>
                        <div class="card-body">
                            <form class="needs-validation" novalidate>
                                <div class="mb-4">
                                    <label for="currentPassword" class="form-label">Current Password *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="bi bi-lock"></i>
                                        </span>
                                        <input type="password" class="form-control" id="currentPassword" required>
                                        <button class="btn btn-outline-secondary password-toggle" type="button">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <div class="invalid-feedback">
                                            Please enter your current password.
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="newPassword" class="form-label">New Password *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="bi bi-lock-fill"></i>
                                        </span>
                                        <input type="password" class="form-control" id="newPassword" required minlength="8">
                                        <button class="btn btn-outline-secondary password-toggle" type="button">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <div class="invalid-feedback">
                                            Password must be at least 8 characters long.
                                        </div>
                                    </div>
                                    <div class="form-text">
                                        Password must be at least 8 characters long and contain letters and numbers.
                                    </div>
                                    
                                    <!-- Password Strength Indicator -->
                                    <div class="mt-2">
                                        <div class="progress" style="height: 5px;">
                                            <div class="progress-bar" id="passwordStrength" role="progressbar" style="width: 0%"></div>
                                        </div>
                                        <small class="text-muted" id="passwordStrengthText">Password strength</small>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label for="confirmPassword" class="form-label">Confirm New Password *</label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="bi bi-lock-fill"></i>
                                        </span>
                                        <input type="password" class="form-control" id="confirmPassword" required>
                                        <button class="btn btn-outline-secondary password-toggle" type="button">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                        <div class="invalid-feedback">
                                            Passwords do not match.
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Password Requirements -->
                                <div class="alert alert-info">
                                    <h6 class="alert-heading">Password Requirements:</h6>
                                    <ul class="mb-0">
                                        <li>At least 8 characters long</li>
                                        <li>Contains at least one uppercase letter</li>
                                        <li>Contains at least one lowercase letter</li>
                                        <li>Contains at least one number</li>
                                        <li>Contains at least one special character</li>
                                    </ul>
                                </div>
                                
                                <div class="d-flex justify-content-between">
                                    <a href="/profile" class="btn btn-outline-secondary">
                                        <i class="bi bi-arrow-left me-2"></i>Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="bi bi-check-lg me-2"></i>Update Password
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                    
                    <!-- Security Tips -->
                    <div class="card mt-4">
                        <div class="card-header">
                            <h6 class="mb-0">
                                <i class="bi bi-shield-check me-2"></i>Security Tips
                            </h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Use a unique password that you don't use elsewhere
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Avoid using personal information in your password
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Consider using a password manager
                                </li>
                                <li class="mb-2">
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Enable two-factor authentication for extra security
                                </li>
                                <li>
                                    <i class="bi bi-check-circle text-success me-2"></i>
                                    Change your password regularly
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

        <script>
        // Password confirmation validation
        document.getElementById('confirmPassword').addEventListener('input', function() {
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = this.value;
            
            if (newPassword !== confirmPassword) {
                this.setCustomValidity('Passwords do not match');
            } else {
                this.setCustomValidity('');
            }
        });
        
        // Password strength indicator
        document.getElementById('newPassword').addEventListener('input', function() {
            const password = this.value;
            const strength = getPasswordStrength(password);
            const strengthBar = document.getElementById('passwordStrength');
            const strengthText = document.getElementById('passwordStrengthText');
            
            let strengthPercentage = 0;
            let strengthLabel = '';
            let strengthColor = '';
            
            if (strength >= 5) {
                strengthPercentage = 100;
                strengthLabel = 'Very Strong';
                strengthColor = 'bg-success';
            } else if (strength >= 4) {
                strengthPercentage = 80;
                strengthLabel = 'Strong';
                strengthColor = 'bg-success';
            } else if (strength >= 3) {
                strengthPercentage = 60;
                strengthLabel = 'Good';
                strengthColor = 'bg-warning';
            } else if (strength >= 2) {
                strengthPercentage = 40;
                strengthLabel = 'Fair';
                strengthColor = 'bg-warning';
            } else if (strength >= 1) {
                strengthPercentage = 20;
                strengthLabel = 'Weak';
                strengthColor = 'bg-danger';
            } else {
                strengthPercentage = 0;
                strengthLabel = 'Very Weak';
                strengthColor = 'bg-danger';
            }
            
            strengthBar.style.width = strengthPercentage + '%';
            strengthBar.className = 'progress-bar ' + strengthColor;
            strengthText.textContent = strengthLabel;
        });
        
        function getPasswordStrength(password) {
            let strength = 0;
            if (password.length >= 8) strength++;
            if (/[a-z]/.test(password)) strength++;
            if (/[A-Z]/.test(password)) strength++;
            if (/[0-9]/.test(password)) strength++;
            if (/[^A-Za-z0-9]/.test(password)) strength++;
            return strength;
        }
        
        // Form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (this.checkValidity()) {
                ElectroStore.showToast('Password updated successfully!', 'success');
                setTimeout(() => {
                    window.location.href = 'profile.html';
                }, 1500);
            }
            
            this.classList.add('was-validated');
        });
    </script>



<%- include("footer.ejs") %>