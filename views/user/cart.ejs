<%- include("navbar.ejs") %>

    <!-- Breadcrumbs -->
    <section class="breadcrumb-section py-3 bg-light">
        <div class="container">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb mb-0">
                    <li class="breadcrumb-item"><a href="/">Home</a></li>
                    <li class="breadcrumb-item active">Shopping Cart</li>
                </ol>
            </nav>
        </div>
    </section>

    <!-- Cart Section -->
    <section class="cart-section py-5">
        <div class="container">
            <div class="row">
                <div class="col-12">
                    <h2 class="mb-4">Shopping Cart</h2>
                </div>
            </div>
            
            <div class="row">
                <!-- Cart Items -->
                <div class="col-lg-8">
                    <!-- Empty Cart State -->
                     <% if(carts.length == 0) { %>
                    <div id="empty-cart" class="empty-state" style="display: none;">
                        <i class="bi bi-cart-x"></i>
                        <h3>Your cart is empty</h3>
                        <p class="text-muted">Looks like you haven't added any items to your cart yet.</p>
                        <a href="/products" class="btn btn-primary">Start Shopping</a>
                    </div>
                    <% }else {%>
                    <!-- Cart Items List -->
                    <div id="cart-items">
                        <!-- Cart Item 1 -->
                        <%
                         var subtotal_price = 0;
                         for(var i=0; i < carts.length; i++) { 
                         subtotal_price += (carts[i].variation_price * carts[i].quantity);
                         %>
                        <div class="cart-item" data-product-id="1">
                            <div class="row align-items-center">
                                <div class="col-md-2">
                                    <img src="/uploads/products/<%= carts[i].product_main_image %>" 
                                         class="cart-item-image" alt="iPhone 15 Pro">
                                </div>
                                <div class="col-md-4">
                                    <h5 class="mb-1"><%= carts[i].product_name %></h5>
                                    <p class="text-muted mb-1"><%= carts[i].variation_title %> : <%= carts[i].color %></p>
                                </div>
                                <div class="col-md-2">
                                    <div class="quantity-stepper">
                                        <button type="button" class="btn-minus" onclick="decrementQuantity('<%= carts[i].cart_id %>')">-</button>
                                        <input type="number" value="<%= carts[i].quantity %>" min="1" max="10" class="form-control text-center quantity_box" id="quantity_box_<%= carts[i].cart_id %>">
                                        <button type="button" class="btn-plus" onclick="incrementQuantity('<%= carts[i].cart_id %>')">+</button>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="text-center">
                                        <div class="h5 mb-0">&#8377;<span class="product_total_price"><%= carts[i].quantity * carts[i].variation_price %></span></div>
                                        <small class="text-muted">&#8377;<span class="product_price"><%= carts[i].variation_price %></span> each</small>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="text-center">
                                        <a href="/remove_from_cart/<%= carts[i].cart_id %>">
                                            <button class="btn btn-outline-danger btn-sm">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                        </a>
                                        <button class="btn btn-outline-secondary btn-sm mt-2" onclick="moveToWishlist('1')">
                                            <i class="bi bi-heart"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <% } %>
                    </div>
                    <% } %>
                    
                    <!-- Coupon Code -->
                    <div class="card mt-4">
                        <div class="card-body">
                            <h5 class="card-title">Have a coupon code?</h5>
                            <div class="row">
                                <div class="col-md-8">
                                    <input type="text" class="form-control" placeholder="Enter coupon code" id="couponCode">
                                </div>
                                <div class="col-md-4">
                                    <button class="btn btn-outline-primary w-100" onclick="applyCoupon()">Apply Coupon</button>
                                </div>
                            </div>
                            <div id="coupon-message" class="mt-2"></div>
                        </div>
                    </div>
                    
                    <!-- Continue Shopping -->
                    <div class="text-center mt-4">
                        <a href="/products" class="btn btn-outline-primary">
                            <i class="bi bi-arrow-left me-2"></i>Continue Shopping
                        </a>
                    </div>
                </div>
                
                <!-- Order Summary -->
                <div class="col-lg-4">
                    <div class="order-summary">
                        <h5 class="mb-3">Order Summary</h5>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Subtotal (<%= carts.length %> items)</span>
                            <span>&#8377;<span id="subtotal_price"><%= subtotal_price %></span></span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Shipping</span>
                            <span class="text-success">Free</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2">
                            <span>Tax</span>
                            <span>Already included</span>
                        </div>
                        
                        <div class="d-flex justify-content-between mb-2" id="discount-row" style="display: none;">
                            <span>Discount</span>
                            <span class="text-success" id="discount-amount">-$0.00</span>
                        </div>
                        
                        <hr>
                        
                        <div class="d-flex justify-content-between mb-4">
                            <strong>Total</strong>
                            <strong id="total-amount">&#8377;<span id="total_price"><%= subtotal_price %></span></strong>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <a href="/checkout">
                                <button class="btn btn-primary btn-lg w-100">
                                    <i class="bi bi-credit-card me-2"></i>Proceed to Checkout
                                </button>
                            </a>
                            <a href="/products">
                            <button class="btn btn-outline-primary w-100" onclick="window.location.href='products.html'">
                                <i class="bi bi-arrow-left me-2"></i>Continue Shopping
                            </button>
                            </a>
                        </div>
                        
                        <!-- Security Badges -->
                        <div class="text-center mt-4">
                            <p class="text-muted small mb-2">Secure checkout with</p>
                            <div class="d-flex justify-content-center gap-3">
                                <i class="bi bi-shield-check text-success" style="font-size: 1.5rem;"></i>
                                <i class="bi bi-lock-fill text-primary" style="font-size: 1.5rem;"></i>
                                <i class="bi bi-credit-card text-info" style="font-size: 1.5rem;"></i>
                            </div>
                        </div>
                        
                        <!-- Trust Signals -->
                        <div class="mt-4">
                            <div class="d-flex align-items-center justify-content-center text-muted small">
                                <i class="bi bi-truck me-2"></i>
                                <span>Free shipping on orders over $50</span>
                            </div>
                            <div class="d-flex align-items-center justify-content-center text-muted small mt-1">
                                <i class="bi bi-arrow-clockwise me-2"></i>
                                <span>30-day return policy</span>
                            </div>
                            <div class="d-flex align-items-center justify-content-center text-muted small mt-1">
                                <i class="bi bi-headset me-2"></i>
                                <span>24/7 customer support</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script>
        function incrementQuantity(cart_id) {
            $.ajax({
                url: `increment_quantity/${cart_id}`})
                .done(function(response) {
                    console.log(response[0].quantity);
                    document.getElementById(`quantity_box_${cart_id}`).value = response[0].quantity;
                    calculateTotal();
                });
        }
       
        function decrementQuantity(cart_id) {
            $.ajax({
                url: `decrement_quantity/${cart_id}`})
                .done(function(response){
                    console.log(response[0].quantity);
                    document.getElementById(`quantity_box_${cart_id}`).value = response[0].quantity;
                    calculateTotal();
                });
        }

        function calculateTotal() {
            var subtotal_price = 0;
            var quantity_box = $('.quantity_box');
            var product_price = $('.product_price');
            var product_total_price = $('.product_total_price');

            for (var i = 0; i < quantity_box.length; i++)
            {
                product_total_price[i].innerText = quantity_box[i].value * product_price[i].innerText;
                subtotal_price += Number(product_total_price[i].innerText);
            }
            document.getElementById('subtotal_price').innerText = subtotal_price;
            document.getElementById('total_price').innerText = subtotal_price;
        }
    </script>


<%- include("footer.ejs") %>