<%- include("navbar.ejs") %>

<!-- Admin Panel Header -->
<nav class="navbar navbar-expand-lg shadow-sm px-4" style="background: #ffffff;">
  <a class="navbar-brand d-flex align-items-center text-dark fw-bold" href="#">
    <img src="favicon.png" alt="Logo" width="42" height="42" class="me-2 rounded-circle border border-light shadow-sm">
    ElectroStore - Premium Electronics Store
  </a>
  <div class="ms-auto d-flex align-items-center text-dark fw-semibold">
    <i class="bi bi-person-circle me-2"></i> Welcome, Lalit
  </div>
</nav>

<!-- Dashboard Summary Cards -->
<div class="container my-5">
  <div class="row g-4">
    <div class="col-md-4 col-lg-2">
      <div class="card shadow-sm" style="background: #f8f9fa;">
        <div class="card-body text-center">
          <h6>Total Users</h6>
          <h3 class="fw-bold text-dark"><%= JSON.stringify(totalUsers) %></h3>
          <i class="bi bi-people-fill fs-3 text-primary"></i>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-lg-2">
      <div class="card shadow-sm" style="background: #f8f9fa;">
        <div class="card-body text-center">
          <h6>Total Orders</h6>
          <h3 class="fw-bold text-dark"><%= totalOrders %></h3>
          <i class="bi bi-cart-fill fs-3 text-primary"></i>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-lg-2">
      <div class="card shadow-sm" style="background: #f8f9fa;">
        <div class="card-body text-center">
          <h6>Total Products</h6>
          <h3 class="fw-bold text-dark"><%= totalProducts %></h3>
          <i class="bi bi-box-seam fs-3 text-primary"></i>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-lg-3">
      <div class="card shadow-sm" style="background: #f8f9fa;">
        <div class="card-body text-center">
          <h6>Total Revenue</h6>
          <h3 class="fw-bold text-dark">â‚¹1000</h3>
          <i class="bi bi-currency-rupee fs-3 text-primary"></i>
        </div>
      </div>
    </div>

    <div class="col-md-4 col-lg-3">
      <div class="card shadow-sm" style="background: #f8f9fa;">
        <div class="card-body text-center">
          <h6>Pending Orders</h6>
          <h3 class="fw-bold text-dark"><%= orderCounts.pendingOrders %></h3>
          <i class="bi bi-clock fs-3 text-primary"></i>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Charts Section -->
<div class="container my-5">
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header text-dark" style="background: #f8f9fa;">
          <h5 class="mb-0 text-primary">ðŸ“ˆ Sales Chart</h5>
        </div>
        <div class="card-body">
          <canvas id="salesChart" style="width:100%; max-height:400px;"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header text-dark" style="background: #f8f9fa;">
          <h5 class="mb-0 text-primary">ðŸ“Š Orders Status</h5>
        </div>
        <div class="card-body">
          <canvas id="ordersPieChart" style="width:100%; max-height:400px;"></canvas>
        </div>
      </div>
    </div>

    <div class="col-lg-12">
      <div class="card shadow-sm border-0 rounded-4">
        <div class="card-header text-dark" style="background: #f8f9fa;">
          <h5 class="mb-0 text-primary">ðŸ‘¥ User Growth</h5>
        </div>
        <div class="card-body">
          <canvas id="userGrowthChart" style="width:100%; max-height:400px;"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const salesCtx = document.getElementById('salesChart').getContext("2d");
  new Chart(salesCtx, {
    type: "line",
    data: {
      labels: <%- JSON.stringify(dates) %>,
      datasets: [{
        label: "Sales",
        data: <%- JSON.stringify(total_amounts) %>,
        fill: true,
        backgroundColor: "rgba(37,99,235,0.1)",
        borderColor: "#2563eb",
        borderWidth: 3,
        pointBackgroundColor: "#2563eb",
        pointRadius: 5
      }]
    },
    options: { responsive: true, plugins: { legend: { display: false } } }
  });

  const ordersCtx = document.getElementById('ordersPieChart').getContext("2d");
  new Chart(ordersCtx, {
    type: 'pie',
    data: {
      labels: ['Completed', 'Pending', 'Cancelled'],
      datasets: [{
        data: [<%= orderCounts.completedOrders %>, <%= orderCounts.pendingOrders %>, <%= orderCounts.cancelledOrders %>],
        backgroundColor: ['#2563eb', '#3b82f6', '#60a5fa'],
      }]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });

  const userGrowthCtx = document.getElementById('userGrowthChart').getContext("2d");
new Chart(userGrowthCtx, {
  type: "bar",
  data: {
    labels: <%- JSON.stringify(userGrowthDates) %>,
    datasets: [{
      label: "New Users",
      data: <%- JSON.stringify(userGrowthCounts) %>,
      backgroundColor: <%- JSON.stringify(userGrowthCounts.map(c => c === 0 ? 'rgba(37,99,235,0.2)' : '#2563eb')) %>,
      borderColor: "#2563eb",
      borderWidth: 1
    }]
  },
  options: {
    responsive: true,
    plugins: {
      legend: { display: false },
      tooltip: {
        callbacks: {
          label: function(context) {
            return `${context.raw} user${context.raw !== 1 ? 's' : ''}`;
          }
        }
      }
    },
    scales: {
      y: {
        beginAtZero: true,
        ticks: { stepSize: 1 }
      }
    }
  }
});
</script>

<%- include("footer.ejs") %>
