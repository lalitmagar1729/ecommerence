<%- include("navbar.ejs") %>

<!-- User Inquiries Section -->
<div class="container bg-white rounded-2 shadow-sm my-4 p-4">
  <div class="row mb-3">
    <div class="col">
      <h4 class="fw-bold mb-0">
        <i class="bi bi-envelope-open me-2 text-primary"></i>User Inquiries
      </h4>
      <p class="text-muted mb-0">All messages submitted through the website contact form.</p>
      <hr>
    </div>
  </div>

  <table class="table align-middle table-bordered table-hover">
    <thead class="table-light text-center">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Subject</th>
        <th>Message</th>
        <th>Date</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% if (contact_messages && contact_messages.length > 0) { %>
        <% for (var i = 0; i < contact_messages.length; i++) { %>
          <tr class="text-center">
            <!-- Index -->
            <td><%= i + 1 %></td>

            <!-- Name -->
            <td class="fw-semibold">
              <%= contact_messages[i].first_name %> <%= contact_messages[i].last_name %>
            </td>

            <!-- Email -->
            <td>
              <a href="mailto:<%= contact_messages[i].email %>" 
                 class="text-decoration-none text-primary" 
                 title="Send Email">
                <%= contact_messages[i].email %>
              </a>
            </td>

            <!-- Phone -->
            <td><%= contact_messages[i].phone %></td>

            <!-- Subject -->
            <td><%= contact_messages[i].subject %></td>

            <!-- Message (Truncated with tooltip) -->
            <td class="text-start">
              <span title="<%= contact_messages[i].message %>">
                <%= contact_messages[i].message.length > 60 
                    ? contact_messages[i].message.substring(0, 60) + "..." 
                    : contact_messages[i].message %>
              </span>
            </td>

            <!-- Date -->
            <td><%= new Date(contact_messages[i].created_at).toLocaleDateString() %></td>

            <!-- Actions -->
            <td>
              <a href="/admin/delete_message/<%= contact_messages[i].contact_id %>" 
                 class="btn btn-sm btn-danger" 
                 onclick="return confirm('Are you sure you want to delete this message?')" 
                 title="Delete Message">
                <i class="bi bi-trash"></i>
              </a>
            </td>
          </tr>
        <% } %>
      <% } else { %>
        <tr>
          <td colspan="8" class="text-center text-muted py-4">
            <i class="bi bi-inbox fs-3 d-block mb-2"></i>
            No Inquiries Found
          </td>
        </tr>
      <% } %>
    </tbody>
  </table>
</div>

<%- include("footer.ejs") %>

<!-- Optional Styling -->
<style>
  .table-hover tbody tr:hover {
    background-color: #f8f9fa !important;
    transition: background-color 0.3s ease;
  }

  .table thead th {
    vertical-align: middle;
  }

  a.btn {
    transition: all 0.2s ease-in-out;
  }

  a.btn:hover {
    transform: scale(1.05);
  }
</style>
